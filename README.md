# Deep Research App (深度研究器)

## 描述

这是一个基于 Node.js 的 Web 应用程序，旨在模拟一个由 AI Agent 驱动的深度研究工作流。用户可以提出研究主题，应用程序将协调不同的 AI 模型（强推理模型和快速模型）以及模拟的网络搜索功能，自动完成信息收集、分析判断，并最终生成一份研究报告。

## 特性

*   **交互式研究规划**: 通过与 AI (NovaAI - 强模型) 对话来确定研究目标和计划。
*   **自动关键词生成**: 根据研究计划自动生成中英文搜索关键词 (快模型)。
*   **并行模拟搜索**: 并发地为多个关键词启动模拟搜索任务 (快模型，通过调用自身生成摘要模拟搜索结果)。
*   **深度判断**: AI (强模型) 根据收集到的信息判断是否需要进一步研究，并可提出新的关键词。
*   **报告自动生成**: AI (强模型) 基于整个研究流程收集的信息，自动撰写最终报告。
*   **模型分工**: 利用强模型进行复杂推理和生成，利用快模型进行快速响应和并发任务。
*   **时空锚定**: 向所有模型注入当前系统时间和地理位置，减少幻觉。
*   **双模型搜索能力**: 强模型和快模型均可在需要时触发（模拟）搜索。
*   **报告下载**: 支持将最终生成的研究报告下载为 Markdown 文件。
*   **配置灵活**: 通过 `config.env` 文件配置 API 地址、密钥、模型名称及各个 Agent 的系统提示词。

## 技术栈

*   **后端**: Node.js, Express.js
*   **API 通信**: Axios
*   **配置管理**: dotenv
*   **前端**: HTML, CSS, JavaScript (原生)
*   **开发工具**: nodemon

## 配置 (`config.env`)

在运行应用前，请确保项目根目录下存在 `config.env` 文件，并已正确配置以下变量：

*   `API_Key`: 访问 OpenAI 兼容 API 的密钥。
*   `API_URL`: API 服务器的基础 URL (例如 `http://192.168.2.179:3000`)。
*   `ThinkModel`: 强推理模型的名称 (例如 `gemini-2.5-pro-exp-03-25`)。
*   `ThinkModelTemp`, `ThinkModelMaxTokens`, `ThinkModeContent`: 强模型的参数。
*   `FastModel`: 快速模型的名称 (例如 `gemini-2.5-flash-preview-04-17`)。
*   `FastModelTemp`, `FastModelMaxTokens`, `FastModeContent`: 快速模型的参数。
*   `DeepResearchPrompt`: NovaAI 的系统提示词。
*   `ChoicePrompt`: 检索词生成器的系统提示词。
*   `RealSearchPrompt`: 异步联网检索器的系统提示词 (其中 `[[keyword]]` 会被替换)。
*   `DeepJudgePrompt`: 检索深度判断器的系统提示词。
*   `PaperGenerationPrompt`: 报告生成器的系统提示词。
*   `TimePrompt`: 时效注入器的模板 (包含 `{{Date::Time}}` 占位符)。

## 安装与设置

1.  确保已安装 Node.js 和 npm。
2.  克隆或下载项目代码。
3.  在项目根目录下打开终端。
4.  运行以下命令安装依赖：
    ```bash
    npm install
    ```
5.  根据上述说明创建并配置 `config.env` 文件。

## 运行应用

提供两种方式启动开发服务器：

1.  **使用 npm 脚本 (推荐)**:
    ```bash
    npm run dev
    ```
    这将使用 `nodemon` 启动服务器，它会自动监控文件变化并重启服务。

2.  **使用批处理文件 (Windows)**:
    直接双击项目根目录下的 `start_dev.bat` 文件。

服务器启动后，默认监听 `http://localhost:3001`。请检查控制台输出确认 API 配置是否加载成功。

## 使用方法

1.  在浏览器中打开服务器地址 (例如 `http://localhost:3001`)。
2.  在底部的输入框中输入你想要研究的主题，然后点击“发送”或按 Enter。
3.  与 NovaAI 对话，明确研究计划。
4.  当 NovaAI 输出 `[[DeepResearchStart]]` 后，研究流程将自动进行（关键词生成 -> 并行搜索 -> 深度判断 -> 可能的再次搜索 -> ... -> 报告生成）。
5.  流程结束后，最终报告会显示在聊天界面中。如果报告成功生成，报告消息下方会出现“下载报告 (.md)”按钮。

## 重要提示与局限性

*   **搜索**: 当前版本的网络搜索功能是通过内部调用 FastModel 生成摘要来搜索的。确保所使用的 Gemini API 端点能正确、完全地处理内置的 `google_search` 功能并返回真实结果。
*   **API 成本**: 使用大型语言模型会产生费用，请注意监控你的 API 使用量和相关成本。
*   **错误处理**: 虽然进行了一些错误处理，但在复杂的流程中仍可能遇到未预料的 API 错误或网络问题。
*   **图片上传**: 前端界面包含图片上传按钮，但相关的文件上传和处理逻辑尚未实现。
